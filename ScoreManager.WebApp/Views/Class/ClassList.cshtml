@using Models
@model List<EDU_CLASS>
@{
    ViewData["Title"] = "班级列表";
}

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">
                    <button class="layui-btn" onclick="xadmin.open('添加班级','/Class/AddClass',600,400)"><i class="layui-icon"></i>添加</button>
                </div>
                <div class="layui-card-body layui-table-body layui-table-main">
                    <table class="layui-table layui-form">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>班级名称</th>
                                <th>添加时间</th>
                                <th>班主任</th>
                                <th>学科老师</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.ID</td>
                                    <td>@item.NAME</td>
                                    <td>@item.ADDTIME</td>
                                    <td>@item.MasterTeacherName</td>
                                    <td>@item.SubjectTeacherNames</td>
                                    <td class="td-status">
                                        @if (item.ISENABLE == "1")
                                        {
                                            <span class="layui-btn layui-btn-normal layui-btn-mini">已启用</span>
                                        }
                                        else
                                        {
                                            <span class="layui-btn layui-btn-normal layui-btn-mini layui-btn-disabled">已停用</span>
                                        }

                                    </td>

                                    <td class="td-manage">
                                        @if (item.ISENABLE == "1")
                                        {
                                            <a onclick="member_stoporstart(this,@item.ID)" href="javascript:;" title="停用">
                                                <i class="layui-icon">&#xe601;</i>
                                            </a>
                                        }
                                        else
                                        {
                                            <a onclick="member_stoporstart(this,@item.ID)" href="javascript:;" title="启用">
                                                <i class="layui-icon">&#xe62f;</i>
                                            </a>
                                        }
                                        <a title="分配教师" onclick="xadmin.open('分配教师','/Class/EditClass?id='+@item.ID,600,400)" href="javascript:;">
                                            <i class="layui-icon">&#xe642;</i>
                                        </a>
                                         <a onclick="xadmin.open('分配学生','/Class/SetStudents?id='+@item.ID,520,500)" title="分配学生" href="javascript:;">
                                        <i class="layui-icon">&#xe631;</i>
                                      </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['form'], function() {

        var form = layui.form;





    });

     /*班级-停用-启用*/
    function member_stoporstart(obj, id) {
        var title = $(obj).attr('title');
        var confirmMsg = '确认要' + title + '吗？'
        var status = title == "停用" ? "0" : "1";
        layer.confirm(confirmMsg, function(index) {
            //发异步把用户状态进行更改
            $.post("/Class/EnableOrDisAbledClass", { "id": id ,"status":status}, function(ret) {
                debugger;
                if (ret.Code == 0) {
                    if (status == "0") {
                        $(obj).attr('title', '启用')
                        $(obj).find('i').html('&#xe62f;');

                        $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                        layer.msg('已停用!', { icon: 5, time: 1000 });

                    } else {
                        $(obj).attr('title', '停用')
                        $(obj).find('i').html('&#xe601;');

                        $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                        layer.msg('已启用!', { icon: 6, time: 1000 });
                    }
                } else {
                    layer.msg(ret.Message, { icon: 5, time: 1000 });
                }
            });


        });
    }

</script>
