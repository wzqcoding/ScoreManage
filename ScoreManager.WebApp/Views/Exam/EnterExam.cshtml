@using Microsoft.AspNetCore.Http
@using Models
@model EDU_EXAMINE_PAPER
@{
    string stuName = ViewBag.StudentName as string;
    long examId = long.Parse(ViewBag.ExamId.ToString());
}
<form class="layui-form" id="myForm">
    <div class="layui-card-body layui-table-body layui-table-main">
        <span style="text-align:center">
            <h3>
                欢迎 <i>@stuName</i> 进入 <span style="font-weight:bold">@Model.NAME</span> 考试
            </h3>
        </span>


        <table class="layui-table layui-form">
            <thead>
                <tr>
                    <th width="80">序号</th>
                    <th>试题内容</th>
                    <th>你的答案</th>

                </tr>
            </thead>
            <tbody id="tbody">
                @foreach (var item in Model.Questions)
                {
                    <tr class="trData">
                        <td><input type="text" disabled name="questionOrder" lay-verify="titleIndex" autocomplete="off" value="@item.ORDERINDEX" class="layui-input"></td>
                        <td><input type="text" disabled name="questionContent" lay-verify="titleContent" autocomplete="off" value="@item.DESCRIPTION" class="layui-input"></td>
                        <td><input type="text" name="questionResult" lay-verify="titleResult" autocomplete="off" placeholder="请输入试题答案" class="layui-input"><input type="hidden" value="@item.ID" /></td>

                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="layui-form-item" style="text-align:right;">

        <button class="layui-btn" style="margin-right:5%;" lay-filter="add" onclick=" return false;" lay-submit="">
            交卷
        </button>
    </div>
</form>


<script>
    layui.use(['form', 'layer'], function() {
        var form = layui.form,
                layer = layui.layer;



        //监听提交
        form.on('submit(add)',
            function(data) {


                layer.confirm('确认要交卷吗？', function(index) {

                    var postData = [];
                    var trs = $("#tbody tr");
                    for (i = 0; i < trs.length; i++) {
                        var inputs = $(trs[i]).find("td input");
                        var Answer = $(inputs[2]).val();
                        var QuestionId = $(inputs[3]).val();
                        postData.push({ "QuestionId": QuestionId, "Answer": Answer });

                    }
                    //console.log(postData) ;
                    //console.log(data);
                    $.post("/Exam/SubmitPaper", { "Questions": postData, "ExamId": @examId}, function(ret) {
                        if (ret.Code == 0) {
                            //发异步，把数据提交给php
                            layer.alert("交卷成功", {
                                icon: 6
                            },
                                function() {
                                    //关闭当前frame
                                    xadmin.close();

                                    // 可以对父窗口进行刷新
                                    xadmin.father_reload();
                                });
                        } else {
                            layer.alert("交卷失败", {
                                icon: 5
                            });
                        }

                    });

                });

            });
    });
</script>                     